<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:,">
    <title>Document</title>
    <script src="resources/js/paho.javascript-1.0.3/paho-mqtt-min.js"></script>
    <script src="resources/js/connection.js"></script>
    <style>
             body{touch-action: pan-y;}
        * {
	margin: 0;
	padding: 0;
    font-family: 'Avenir', sans-serif;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;




}
#device_div { width: 100%;margin: 0 auto;}

table{ margin: 0 auto; width: 100%; height: 100%;border-collapse: separate; border-spacing: 2.5vw;}

td{ box-shadow: 0.5px 0.5px 3px 0.5px gray; border-radius: 7px; padding-left: 10px;padding-right: 20px; padding-top:5px; padding-bottom:10px ; width: 30%;}

.img-container {width: 40px;  height: 38px; overflow: hidden; position: relative;} 
.img-container img { width: 100%; height: auto; display: block; position: absolute; top: 50%;left: 50%;transform: translate(-50%, -50%);}

 .caption{margin-right: 15px;margin-left: 15px;  border-bottom: 1px solid rgb(211, 207, 207); margin-top: 10px; }
 p.device_name{font-size: 13px; font-weight: bold;}

p.zone{ font-size: 10px; padding-top: 3px;}

.dot{
 
   width: 7px;
   height:7px;
   border-radius:5px 5px;
    background-color:#b4b4b0;
   margin: 0 auto;
   bottom: 0;
   }
   .dotConnction
   {
    
   width: 7px;
   height:7px;
   border-radius:5px 5px;
    background-color:red;
   margin: 0 auto;
   bottom: 0;
   }
   .dotdiv
   {
    bottom: 0;
       position: fixed;
       margin: 0 auto;
       width:100%;
       padding: 10px;
       border-top: 1px; /* Add a border at the top for separation */
       z-index: 1000; /* Ensure it stays above other content */
   }
  #waterpump.hover-effect{box-shadow: none; opacity: 0.2; background-color: #EEEEEE; }
  #powerSource.hover-effect{box-shadow: none; opacity: 0.2; background-color: #EEEEEE; }
  #flood.hover-effect{box-shadow: none; opacity: 0.2; background-color: #EEEEEE; }
  #cctv.hover-effect{box-shadow: none; opacity: 0.2; background-color: #EEEEEE; }
  #smoke.hover-effect{box-shadow: none; opacity: 0.2; background-color: #EEEEEE; }
  #siren.hover-effect{box-shadow: none; opacity: 0.2; background-color: #EEEEEE; }
  .popup {
    width: 80%;
  display: none; 
  position: fixed;
  top: 90%; 
  left: 50%; 
  transform: translate(-50%, -50%); 
  border-radius: 10px 10px;
  background-color:#7D63BE;
  padding: 12px 12px 12px 12px;
  z-index: 9999; 
  color: white;

 
}


.popup-content {text-align: center; margin-bottom:0%; }


#nav-Button{   
  width: 92%;  margin: 0 auto; overflow: hidden;color:white;font-size: 13px; margin-top: 2vw;
}
#nav-device-div{
  width: 48%; float: left; display: flex; justify-content: center;
}
#nav-scene-div{
  width: 48%; float: right; display: flex; justify-content: center;
}
#device-button{
  width: 100%; padding: 6px; border:1px solid white; text-align: center; background-color: #68B581;
  border-radius: 5px; margin:  0 auto; 
}
#scene-button
{
  width: 100%; padding: 6px; border:1px solid white; text-align: center;
  background-color: #9B9B9B; border-radius: 5px;
}


#scene-div {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  width: 97%; margin: 0 auto;
  position: relative;

}

.box {
  width: 50%;
  margin-top: 2.5vw;
  display: flex;
  justify-content: center;
}

.block-L, .block-R {
  width: 95%;
  height: 90px;
  padding: 8px;
  box-shadow: 0.5px 0.5px 3px 0.5px gray;
  border-radius: 7px;
  position: relative;
}

#scene-div img {
  width: 40px;
  height: 38px;
}

#scene-div p{

font-size: 10px; 
padding-bottom:2px;
}


.left-box {
  float: left;
 
}

.right-box {
  float: right;

}

.box:nth-child(2n+1) {
  clear: both;
}
#scene-div .Fav_main{
width: 25px;
height: 25px;
position: absolute;
top: 8px; 
right: 8px;
border-radius: 50%;
background-color: rgb(199, 203, 212);
}

.Fav_main img{
  width: 18px !important;
  height: 18px !important;
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-top:2px;
}

#scene_manage {
            width: 100%;
            display: none;
            justify-content: center;
            position: fixed;
            bottom: 20px; 
            height: 75px;
 }

 #scene_button  {
            width: 98%;
            height: 46px;
            text-align: center;
            color: white;
            background-color: #7D63BE;
            border-radius: 5px;
            border: none;
            font-size: 18px;
              margin-top:32px;
        }


#scene-manage{
  width: 98%; margin: 0 auto; overflow: hidden;color:black;font-size: 13px; margin-top: 2vw; margin-bottom: 3vw;
  border: 1px solid #3091E5; border-radius: 6px;;
}
#left-side{
  width: 70%; margin-top: 1vw; margin-bottom: 1vw; float: left; display: flex;
}
#right-side{
  width: 30%;margin-top: 1vw; margin-bottom: 1vw; float: right; display: flex; justify-content: right; 
}
#scene-manage p{

  margin-top: 10px;
}

#scene_manage_div {
  width: 100%;
}
#scene_manage_div header
{
  position: fixed;

  padding: 9px;
}
#scene_manage_list {
    border: none;
    overflow-x: hidden;
    overflow-y: auto;
    width: 95%;
    height: 60%;
    position: fixed;
    top: 100px;
    left: 50%;
    transform: translateX(-50%); 
    margin: 0 auto;
}
#empty_schudule #no_sch /*img no schedule */
{
          width: 400px;
          height: 320px;
          display: block;
        margin: 0 auto;
  }
 #deleimg{

width:20px;
height: 20px;
margin-top: 10px;
        }
#scene_icon{
  width: 30px;
  height: 30px;
  margin-top: 5px;
}


#delete_Scene_sch {
            width: 100%;
            left: 50%;
            transform: translateX(-50%); 
            
            justify-content: center;
            position: fixed;
            bottom: 20px; 
            height: 43px;
        }
#delete_all_schedule  {
            width: 98%;
            height: 46px;
            text-align: center;
            color: white;
            background-color: #3091E5;
            border-radius: 5px;
            border: none;
            font-size: 18px;
              margin-top:32px;
              margin: 0 auto;
        }
        


#backicon{

width: 20px;
height: 20px;
}

.popupConfirm ,#popupDeleteAll{
            width: 70%;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            border: 1px solid #ccc;
            border-radius:10px;
            z-index: 9999;
       
         }

.popup-content {
    text-align: center;
}
.pop_button{width: 100%; border-top:solid; border-width: .5px; border-color:gray; position:relative; margin-left: 0px;}

#yesButton,#noButton,#yesButton2,#noButton2{
width: 49%;  
height: 47px;
 border-left: solid;
 border-color: gray;
 border-width: 0.5px;
float: right;
color:blue;
  }
#yesButton,#yesButton2{border-left: none; color:red}
.pop_button p{ text-align:center; margin-bottom: 10px; margin-top: 16px; }


#overlay2 {
     position: fixed;
     display: none;
     width: 100%;
     height: 100%;
     top: 0;
     left: 0;
     right: 0;
     bottom: 0;
     background-color: rgba(0,0,0,0.5);
     z-index: 9995;
     cursor: pointer;
    }

@media only screen and (max-width: 600px) {

.img-container {width: 40px;  height: 40px; overflow: hidden; position: relative;} 
.img-container img { width: 100%; height: auto; display: block; position: absolute; top: 50%;left: 50%;transform: translate(-50%, -50%);}
  .device_name{font-size: 13px;font-weight: bold;}
  .zone{font-size:10px;padding-top: 3px;}
  #scene-div img {width: 40px;  height: 38px;}
}
@media only screen and (min-width: 600px) {

.img-container {width: 60px;  height: 60px; overflow: hidden; position: relative;} 
.img-container img { width: 100%; height: auto; display: block; position: absolute; top: 50%;left: 50%;transform: translate(-50%, -50%);}
.device_name{font-size: 15px;font-weight: bold;}
.zone{font-size:13px;padding-top: 3px;}
td{ box-shadow: 0.5px 0.5px 3px 0.5px gray; border-radius: 10px; padding-left: 15px;padding-right: 20px; padding-top:10px; padding-bottom:10px ; width: 30%;}
#scene-div img{width: 60px;  height: 58px;overflow: hidden; position: relative;}
.block-L, .block-R {width: 95%;height: 110px;padding: 12px;box-shadow: 0.5px 0.5px 3px 0.5px gray;border-radius: 9px;}
#scene-div p{font-size: 11px; padding-bottom:2px;}

}

@media only screen and (min-width: 1024px) {
  
.img-container {width: 80px;  height: 80px; overflow: hidden; position: relative;} 
.img-container img { width: 100%; height: auto; display: block; position: absolute; top: 50%;left: 50%;transform: translate(-50%, -50%);}
 .device_name{font-size: 17px;font-weight: bold;}
  .zone{font-size:15px;padding-top: 3px;}
  #device_div {width: 80%;margin: 0 auto;}
  .dotdiv{width: 80%;}
  #scene-div img{width: 80px; height: 78px;}

.block-L, .block-R {width: 95%;height: 130px;padding: 12px;box-shadow: 0.5px 0.5px 3px 0.5px gray;border-radius: 9px;}
#scene-div p{font-size: 11px; padding-bottom:2px;}
#scene-div { display: flex; flex-wrap: wrap; justify-content: space-between; width: 77%; margin: 0 auto;}

}




	</style>
</head>
<body>
  <div id="nav-Button">
    <div id="nav-device-div">  
        <div id="device-button" onclick="navfun('device_div','scene-div')">Customize Device</div>
    </div>
    <div id="nav-scene-div" >    
        <div  id="scene-button" onclick="navfun('scene-div','device_div')">Scene Schedule</div>
    </div>
</div>


  </div>
  <div id="device_div" style="display : non">
    <table> 
    
        <tr><td id="waterpump" ontouchstart="addHoverClass('waterpump')" ontouchend="removeHoverClass('waterpump')" style="cursor:pointer;"> <div class="dot" id="node/spc/7469308fcf871dad4d4"style="width: 5px; height: 5px; float:left;"></div>  <div class="img-container">
                <img src="resources\image\pump.png" class="img_td" alt="Pump Image">
            </div><p class="device_name">Water Pump</p><p class="zone">Pump room</p></td>  
			            <td id="flood" ontouchstart="addHoverClass('flood')" ontouchend="removeHoverClass('flood')"><div class="dot" id="node/lls2/923714-42180e2de6b4" style="width: 5px; height: 5px; float:left;"></div>  <div class="img-container">
                <img src="resources\image\flood.png" class="img_td" alt="cctv">
            </div><p class="device_name"> Flood Level </p><p class="zone">Graden</p></td>
			
        
			
        </tr>
        <tr><td id="siren" ontouchstart="addHoverClass('siren')" ontouchend="removeHoverClass('siren')"><div class="dot" id="bsa" style="width: 5px; height: 5px; float:left;"></div>  <div class="img-container">
                <img src="resources\image\siren.jpg" class="img_td" alt="siren">
            </div><p class="device_name"> Home Siren</p><p class="zone">Home</p></td>  
        
            <td id="powerSource" ontouchstart="addHoverClass('powerSource')" ontouchend="removeHoverClass('powerSource')"><div class="dot" id="" style="width: 5px; height: 5px; float:left;"></div>  <div class="img-container">
                <img src="resources\image\power.jpg" class="img_td" alt="Power">
            </div><p class="device_name">Power Source</p><p class="zone">Home</p></td>

        </tr>   

        <tr>  

          
      <td id="smoke" ontouchstart="addHoverClass('smoke')" ontouchend="removeHoverClass('smoke')" ><div class="dot" id=""style="width: 5px; height: 5px; float:left;"></div>  <div class="img-container">
        <img src="resources\image\smoke.jpg" class="img_td" alt="cctv">
    </div><p class="device_name"> Smoke Detector </p><p class="zone">Home</p></td>

      <td id="cctv" ontouchstart="addHoverClass('cctv')" ontouchend="removeHoverClass('cctv')"><div class="dot" id=""style="width: 5px; height: 5px; float:left;"></div>  <div class="img-container">
          <img src="resources\image\cctv\cam.png" class="img_td" alt="cctv">
      </div><p class="device_name"> CCTV Bridge </p><p class="zone">Home</p></td>

  </tr>   

  <tr>  


    <td id="" style="opacity: 0.5;" onclick="openPopup()" ><div class="dot" id=""style="width: 5px; height: 5px; float:left"></div>  <div class="img-container">
        <img src="resources\image\vehicle.png" class="img_td" alt="cctv">
    </div><p class="device_name"> GPS Tracker </p><p class="zone">Home</p></td>

</tr>
    </table>
  
    <div class="dotdiv">
      <div class="dotConnction" id="page1"style="width: 10px; height: 10px;"></div>
      </div>
  </div>




    <div id="scene-div" style="display: none; "></div>
  
            <!-- The popup message box -->
   <div id="popup" class="popup" >
              <div class="popup-content" >
                <p style=" font-size: 12px;">This Device Has Not Been Registered!</p></div> 
              
             </div>

            <div id="scene_manage">
              <button id="scene_button" onclick="navSceneManage()">Scene Manage</button>
           </div>
          
          <div id="scene_manage_div" style="display:none; ">
            <header>
              <img src="resources\image\backbutton.png" id="backicon" onclick="navSceneList()">
              <h2>Scene Manage</h2>
            </header>
       
          <div id="scene_manage_list"></div>

          <div id="delete_Scene_sch">
            <button id="delete_all_schedule" onclick="actionDeleteAll()">Delete All Schedules</button>
        </div>
          </div>

          
<div id="popupConfirmid" class="popupConfirm">
  <div style="padding: 20px;">   <div class="popup-content">
    <p>Are you sure you want to delete schedules releted to this scene?This change can not be undone.</p>  </div></div>
<div class="pop_button">
    <div id="noButton"><p>No</p></div>
      <div id="yesButton"><p>Yes</p></div></div>
</div>

<div id="popupDeleteAll" class="popupConfirm">
  <div style="padding: 20px;">   <div class="popup-content">
    <p>Are you sure you want to delete all schedules?This change can not be undone.</p>  </div></div>
<div class="pop_button">
    <div id="noButton2"><p>No</p></div>
      <div id="yesButton2"><p>Yes</p></div></div>
</div>


<div id="overlay2"></div>

<script>
var  payload, topic,topicsArray,stat1=0,stat2=0,stat3=0,stat4=0,sum_stat=0,
     companyID="node", 
         // Device type..........
     deviceTypePump="spc",
     deviceTypeFlood="lls2",
		 deviceTypeSiren="bsa",
        // Device Id.................
     deviceIDPump="7469308fcf871dad4d4",
     deviceIDFlood="923714-42180e2de6b4",
		 deviceIDSiren="8983514-da13896f6480",

     device_id_siren = ['16351370-8a80f94dffbc','16334980-8440f94dffbc', '16337445-254af94dffbc', '16336187-3b45f94dffbc'],
/*
 '14028845-2d10d6e768e8',
  '8973248-c0eb886f6480',
  '8983514-da13896f6480',
  '8955008-80a4886f6480'
*/

         // Device Topic.....................
      pumpTopic= companyID+"/"+deviceTypePump+"/"+"n2b/"+deviceIDPump+"/+",
      floodTopic= companyID+"/"+deviceTypeFlood+"/"+"n2b/"+deviceIDFlood+"/+",
		  SirenTopic= companyID+"/"+deviceTypeSiren+"/"+"+/"+"+"+"/+",
// scene.................................................................................................................
      device_button=document.getElementById('device-button'),
      scene_button=document.getElementById('scene-button'),
      scene_manage=document.getElementById('scene_manage'),
      scene_div= document.getElementById('scene-div'),
      nav_Button=document.getElementById('nav-Button'),
      delete_all_schedule = document.getElementById('delete_all_schedule'),
      scene_manage_div = document.getElementById('scene_manage_div'), // display scene list for delete 
      popupConfirmid=document.getElementById('popupConfirmid'),
      popupDeleteAll=document.getElementById('popupDeleteAll'),
      overlay2=document.getElementById('overlay2'),
      client, 
      isConnected = false, 
      urlParams = new URLSearchParams(window.location.search),
      Nvvalue = urlParams.get('value'),
      scn_pub_topic="v2jlcwytpqaufx/scene/list",// for scene 
      scn_top = 'v2jlcwytpqaufx/scene/#';
      publish_topic_timers="v2jlcwytpqaufx/scene/timer/";// for schedule




 if (Nvvalue == 'scene-div') {
        connect();
        navfun('scene-div','device_div');

      } else {
        navfun('device_div','scene-div');
      }
     Nvvalue = 0;


     function connect(){    
            try{
        client.connect({ onSuccess: onConnect,useSSL:mqttUseSSL,userName,password});
        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;
            }catch(error)
            {
          
            }
        }
        //............................................................................................
          function onConnect() {
          console.log("onConnect");
          document.getElementById('page1').style.backgroundColor="green";
           getDataFromDevice(pumpTopic); 
           getDataFromDevice(floodTopic); 
		        getDataFromDevice(SirenTopic); 
            getDataFromDevice(scn_top); 
            isConnected = true; 
 
        }
        
        function onConnectionLost(responseObject) {
          if (responseObject.errorCode !== 0) {
            console.log("onConnectionLost:"+responseObject.errorMessage);
            document.getElementById('page1').style.backgroundColor="#FF3827"
          document.getElementById('node/spc/7469308fcf871dad4d4').style.backgroundColor="#b4b4b0";
          document.getElementById('node/lls2/923714-42180e2de6b4').style.backgroundColor="#b4b4b0";
          document.getElementById('bsa').style.backgroundColor="#b4b4b0";
          isConnected = false; 
        }  setInterval(connect, 1000); }

        function onMessageArrived(message) {
            topic = message.destinationName;
            payload=message.payloadString;

            topicsArray = topic.split("/");

        console.log("Payload:" + payload);
        console.log("Topic:", topic);

        if(topicsArray[1] != 'scene' ){
          displayFunction(payload,topic);
        }
        else if(topicsArray[2] == 'list')
        { 
          
          displaySceneList(payload);

         // const uniqueScenesId = setsceneId(payload);
         // console.log(uniqueScenesId);
          
        }
        else if(topicsArray[2] == 'timers')
        {
          const uniqueScenes = extractUniqueScenes(payload);
          console.log(uniqueScenes);
          displaySceneManage(uniqueScenes);

        }
      
      
      }
 /*     function setsceneId(payload) {
    const parsedPayload = JSON.parse(payload);
    const uniqueScenes = {};

    parsedPayload.forEach(item => {
        const sceneID = item.scene_id; // No need to call .map() on a single item
        if (!uniqueScenes[sceneID]) {
            uniqueScenes[sceneID] = {
                sceneName: item.scene_name,
                sceneIcon: item.scene_icon
            };
        }
    });

    // Convert the uniqueScenes object to an array of objects with id, sceneName, and sceneIcon
    const result = Object.keys(uniqueScenes).map(sceneID => ({
        id: sceneID,
        sceneName: uniqueScenes[sceneID].sceneName,
        sceneIcon: uniqueScenes[sceneID].sceneIcon
    }));

    console.log(result);
    return result;
}*/



    function extractUniqueScenes(payload) {
    const parsedPayload = JSON.parse(payload);
    const uniqueScenes = {};

    parsedPayload.forEach(item => {
        const sceneID = item.id.split('_')[0];
        if (!uniqueScenes[sceneID]) {
            
            uniqueScenes[sceneID] = {
                sceneName: item.sceneName,
                sceneIcon: item.sceneIcon
            };
        }
    });

  //  console.log(uniqueScenes);
    return Object.keys(uniqueScenes).map(sceneID => ({
        id: sceneID,
        sceneName: uniqueScenes[sceneID].sceneName,
        sceneIcon: uniqueScenes[sceneID].sceneIcon
    }));
}

    function getDataFromDevice(topic) {
     try{
    console.log("getDataFromDevice "+topic);
    client.subscribe(topic);}
    catch(error){
        console.log(error);}
    }
  
    function sendCommandToDevice(topic, payload) {
  try {
    if (!isConnected) {
      console.log("Client is not connected. Attempting to connect...");
      connect();
    }

    // Wait until the client is connected before sending the message
    const checkConnectionInterval = setInterval(() => {
      if (isConnected) {
        clearInterval(checkConnectionInterval);  // Clear the interval once connected
        const jsonPayload = typeof payload === 'string' ? payload : JSON.stringify(payload);
        console.log("sendCommandToDevice: " + topic + ", Payload: " + jsonPayload);
        var message = new Paho.MQTT.Message(jsonPayload);
        message.destinationName = topic;
        client.send(message);
      }
    }, 100);  // Check every 100ms
  } catch (error) {
    console.log(error);
  }
}


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function navfun(id1,id2)
{
  const id1New=document.getElementById(id1),
        id2New=document.getElementById(id2);
  if(id1 == 'device_div')
  {
  device_button.style.backgroundColor='#68B581';
  scene_button.style.backgroundColor='#9B9B9B';
  id1New.style.display="block";
  id2New.style.display="none"
  scene_manage.style.display="none";
  }
  else if(id1 == "scene-div")
  {
    sendCommandToDevice(scn_pub_topic, 1);
    sendCommandToDevice(publish_topic_timers+"list",'read');

    scene_button.style.backgroundColor='#7D63BE';
    device_button.style.backgroundColor='#9B9B9B';
    scene_manage.style.display="flex";
  }

  id1New.style.display="block";
  id2New.style.display="none";
}

function navSceneManage()
{
  scene_manage_div.style.display="block";
  delete_all_schedule.style.display="block";
  nav_Button.style.display="none";
  scene_div.style.display="none";
  scene_manage.style.display="none";
}
function navSceneList()
{
  scene_manage_div.style.display="none";
  delete_all_schedule.style.display="none";
  nav_Button.style.display="block";
  scene_div.style.display="block";
  scene_manage.style.display="flex";
}
function displaySceneManage(jobs) {
   console.log('hi',jobs)
    //jobs = JSON.parse(jobs);
    const jobsList = document.getElementById('scene_manage_list');
    jobsList.innerHTML = ''; // Clear previous jobs
    if (jobs.length === 0) {
        // Display message when no jobs are found
        const deleteButton = document.getElementById('delete_all_schedule');
        deleteButton.style.backgroundColor = 'rgb(199, 203, 212)';
        deleteButton.style.color = 'black';
        deleteButton.disabled = true;



        const noJobsElement = document.createElement('div');
        noJobsElement.innerHTML = `
            <div id="empty_schudule">
                <small>There are no schedules. Tap "Add New Schedule" to create a schedule.</small><br>
                <img id="no_sch" src="scene/image/no_schdule.png" id="deleimg">
            </div>
        `;
        jobsList.appendChild(noJobsElement);
        return;
    }
    try {
        jobs.forEach(job => {
            const jobElement = document.createElement('div');
            jobElement.innerHTML = `
                <div id="scene-manage">
                    <div id="scene-list">
                        <div id="left-side">&nbsp&nbsp&nbsp&nbsp
                            <img src="resources/image/icons/${job.sceneIcon}.png" id='scene_icon' >&nbsp&nbsp&nbsp&nbsp
                            <p>${job.sceneName}</p>
                        </div>
                        <div id="right-side">
                            <div onclick="actionDelete('${job.id}')">
                                <img src="resources/image/icons/delete.png" id="deleimg">
                            </div>&nbsp&nbsp&nbsp&nbsp
                        </div>
                    </div>
                </div>
            `;
            jobsList.appendChild(jobElement);
        });

      
    } catch (error) {
        console.error('Error displaying jobs:', error);
    }
}

function deleteAllSchedule()
{
  sendCommandToDevice(publish_topic_timers +'delete', 'all');
}
function deleteSceneSchedule(id)
{
  sendCommandToDevice(publish_topic_timers +'all',JSON.stringify(id) );
}



let deleteID = '';

function actionDelete(idDelete) { // action delete 
  popupConfirmid.style.display = 'block';
  overlay2.style.display = 'block';
    deleteID = idDelete.toString();
}

document.getElementById('yesButton').addEventListener('click', function() {
  popupConfirmid.style.display = 'none';
  overlay2.style.display = 'none';
  deleteSceneSchedule(deleteID);

});

document.getElementById('noButton').addEventListener('click', function() {
  popupConfirmid.style.display = 'none';
  overlay2.style.display = 'none';
});



function actionDeleteAll() { // action delete 
  popupDeleteAll.style.display = 'block';
  overlay2.style.display = 'block';
}

document.getElementById('yesButton2').addEventListener('click', function() {
  popupDeleteAll.style.display = 'none';
  overlay2.style.display = 'none';
  deleteAllSchedule()

});

document.getElementById('noButton2').addEventListener('click', function() {
  popupDeleteAll.style.display = 'none';
  overlay2.style.display = 'none';
});

function displaySceneList(payload) {
// Ensure payload is parsed if it's a string
    if (typeof payload === 'string') {
        try {
            payload = JSON.parse(payload);
        } catch (error) {
            console.error('Error parsing payload:', error);
            return;
        }
    }

    // Check if payload is an array
    if (!Array.isArray(payload)) {
        console.error('Payload is not an array:', payload);
        return;
    }
    const jobsList = document.getElementById('scene-div');



    // Clear the previous content
    jobsList.innerHTML = ''; 

    if (payload.length !== 0) {
        try {
            payload.forEach((scene, index) => {
                const jobElement = document.createElement('div');
                if(scene.favorite == true)
                {
                  color ="#7D63BE";
                }else{
                  color ="rgb(199, 203, 212)";
                }
                // Alternate the class based on index
                const boxClass = index % 2 === 0 ? 'left-box' : 'right-box';
                const blockClass = index % 2 === 0 ? 'block-L' : 'block-R';

                jobElement.className = `box ${boxClass}`;
                jobElement.innerHTML = `
                
                    <div class="${blockClass}" onclick="location.href='scene/scene.html?id=${scene.scene_id}&scene_name=${scene.scene_name}&scene_icon=${scene.scene_icon}'">
                        <img src="resources/image/icons/${scene.scene_icon}.png" alt="${scene.scene_name}">
                        <h5>${scene.scene_name}</h5>
                        <p>${scene.scene_description}</p>
                        <div class="Fav_main" style="background-color:${color}"><img src="resources/image/icons/start.png"></div>
                    </div>
                `;

                // Append the new element to the jobs list
                jobsList.appendChild(jobElement);
            });
        } catch (error) {
            console.error('Error displaying scenes:', error);
        }
    }
}


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function displayFunction(payload,topic) {
     topicsArray = topic.split("/");
      payload = JSON.parse(payload);
   
try{
      if (payload['stat'] == 'online')
      {   
        if      (topicsArray[3] == device_id_siren[0]) {stat1 = 1;}
        else if (topicsArray[3] == device_id_siren[1]) {stat2=  1;}
        else if (topicsArray[3] == device_id_siren[2]) {stat3 = 1;}
        else if (topicsArray[3] == device_id_siren[3]) {stat4 = 1;}
        sum_stat=(stat1+stat2+stat3+stat4);
        console.log("s:"+sum_stat);
 
       document.getElementById(topicsArray[0]+'/'+topicsArray[1]+'/'+topicsArray[3]).style.backgroundColor="#7BDD0A";
 
      }
      else if(payload['stat'] == 'offline')
      {
        if      (topicsArray[3] == device_id_siren[0]) {stat1 = 0;}
        else if (topicsArray[3] == device_id_siren[1]) {stat2=  0;}
        else if (topicsArray[3] == device_id_siren[2]) {stat3 = 0;}
        else if (topicsArray[3] == device_id_siren[3]) {stat4 = 0;}
        sum_stat2=(stat1+stat2+stat3+stat4);
        console.log("s2:"+sum_stat);
      
       
        document.getElementById(topicsArray[0]+'/'+topicsArray[1]+'/'+topicsArray[3]).style.backgroundColor="#FF3827";
      
     
      }
    }
      catch(error){
       console.log(error);}
      
       if(sum_stat != device_id_siren.length)
        {
          document.getElementById('bsa').style.backgroundColor="#FF3827";

        }
        else if(sum_stat == device_id_siren.length)
        {
          document.getElementById('bsa').style.backgroundColor="#7BDD0A";
          console.log('doni')

        }
     
      }
               
document.getElementById("waterpump").onclick=function(){location.href="controller/waterpump.html"}
document.getElementById("powerSource").onclick=function(){location.href="controller/powerSource.html"}
document.getElementById("flood").onclick=function(){location.href="controller/flood.html"}
document.getElementById("siren").onclick=function(){location.href="controller/siren.html"}
document.getElementById("smoke").onclick=function(){location.href="controller/smoke.html"}
document.getElementById("cctv").onclick=function(){location.href="controller/cctv.html"}

   function addHoverClass(id) {
    document.getElementById(id).classList.add('hover-effect');
}

function removeHoverClass() {
    document.getElementById(id).classList.remove('hover-effect');
}

// Function to opne the popup
function openPopup() {
  var popup = document.getElementById("popup");
  popup.style.display = "block";

  setTimeout(function() {
    popup.style.display = "none";
  }, 1300); 
  
}

setInterval(connect, 1000);      
connect();
 </script>
</body>
</html>